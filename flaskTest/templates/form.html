<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Drone Operation Manual</title>
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://getbootstrap.com/examples/jumbotron-narrow/jumbotron-narrow.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="../static/js/jquery-1.11.2.js"></script>
  </head>

  <script>
    //CREW
     $(document).ready(function(){
       $('.wrapper1').on('click', '.get_crew_result', function(){
          var selectedPilot = $("#selectedPilot").val();
          $.ajax({
           url: "/update_pilot_info",
           type: "get",
           data: {selectedPilot: selectedPilot},
           success: function(response) {
             $("#PicTitle").val(response.PicTitle.toString());
             $("#faaUasCertNum").val(response.FaaUasCertNum.toString());
             $("#IssueOn").val(response.IssueOn.toString());
             $("#ValidUntil").val(response.ValidUntil.toString());
             $("#AmaNum").val(response.AmaNum.toString());
           },
          });
       });
     });

    //MODEL
     $(document).ready(function(){
       $('.wrapper2').on('click', '.get_model_result', function(){
          var selectedModel = $("#selectedModel").val();
          $.ajax({
           url: "/update_model_info",
           type: "get",
           data: {selectedModel: selectedModel},
           success: function(response) {
            var s = $('<select/>');
            for (var i in response.result) {
              s.append($('<option>', {
                  name: 'selectedDrone',
                  value: response.result[i],
                  text: response.result[i]
              }));
            }
            $('.drone_list').append(s);
           },
          });
       });
     });

     //DRONE
      $(document).ready(function(){
        $('.wrapper2').on('click', '.get_drone_result', function(){
           var selectedDrone = $("#selectedDrone").val();
           $.ajax({
            url: "/update_drone_info",
            type: "get",
            data: {selectedDrone: selectedDrone},
            success: function(response) {
              $(".test").val(response.result);
              // div class='drone_list'
             // var s = $('<select/>');
             // for (var i in response.result) {
             //   s.append($('<option>', {
             //       name: 'selectedDrone',
             //       value: response.result[i],
             //       text: response.result[i]
             //   }));
             //
             // }
             // $('.drone_list').append(s);
            },
           });
        });
      });

      //WEATHER
      $(document).ready(function(){
        $('.wrapper5').on('click', '.get_weather', function(){
           var lat = $("#currLat").val();
           var long = $("#currLong").val();
           var latlng = lat + "," + long;
           $.ajax({
            url: "/get_weather",
            type: "get",
            data: {latlng: latlng},
            success: function(response) {
             $('#weatherTemp').val(response.temp);
             $('#weatherSumm').val(response.text);
            },
           });
        });
      });

      //SUBMIT
      $(document).ready(function(){
        $('.wrapper6').on('click', '.submit_form', function(){
          var pilot = $(".wrapper1 #selectedPilot").val();
          var PicTitle = $(".wrapper1 #PicTitle").val();
          var faa_uas_cert_num = $(".wrapper1 #faaUasCertNum").val();
          var IssueOn = $(".wrapper1 #IssueOn").val();
          var ValidUntil = $(".wrapper1 #ValidUntil").val();
          var AmaNum = $(".wrapper1 #AmaNum").val();
          var selectedModel = $(".wrapper2 #selectedModel").val();
          var lat = $(".wrapper5 #currLat").val();
          var long = $(".wrapper5 #currLong").val();
          var temp = $(".wrapper5 #weatherTemp").val();
          var temp_text = $(".wrapper5 #weatherSumm").val();
          // var data = pilot + "," + FaaUasCertNum + "," + IssueOn + "," + ValidUntil + ","
          //            + AmaNum + "," + selectedModel + "," + lat + "," + long + "," +
          //             temp + "," + tempText;
           // var data = temp;
           // var data = pilot + "," + PicTitle;
           $.ajax({
            url: "/submit",
            type: "get",
            data: {pilot: pilot, pic_title: PicTitle, faa_uas_cert_num:faa_uas_cert_num, issue_on: IssueOn,
                    valid_until:ValidUntil, ama_num:AmaNum, selected_model: selectedModel, lat:lat, long:long,
                    temp: temp, temp_text:temp_text},
            success: function(response) {
              $("#submitForm").val(response.results);
             // $("#submit").val(response.results);
           },
          });
       });
     });

  </script>

  <body>
      <h1>Drone Operation Manual</h1>

      <div class="jumbotron">
        <h1>PILOT</h1>

        <div class='wrapper1'>
          <select id="inputPilot" name="res" method="GET" action="/">
            <option value="{{crewRes[0]}}" selected>{{crewRes[0]}}</option>
            {% for r in crewRes[1:] %}
              <option id="selectedPilot" name="selectedPilot" value="{{r.pilot}}">{{r.pilot}}</option>
            {% endfor %}
          </select>
          <button class='get_crew_result'>Calculate</button>

          <input type="text" name="PicTitle" id="PicTitle" class="form-control" placeholder="PIC Title" readonly>
          <input type="text" name="FaaUasCertNum" id="faaUasCertNum" class="form-control" placeholder="FAA UAS Cert Num" readonly>
          <input type="text" name="IssueOn" id="IssueOn" class="form-control" placeholder="Issued On" readonly>
          <input type="text" name="ValidUntil" id="ValidUntil" class="form-control" placeholder="Valid Unitl" readonly>
          <input type="text" name="AmaNum" id="AmaNum" class="form-control" placeholder="AMA Num" readonly>

        </div>

        <h1>MODEL</h1>
        <!-- // <input type="text" name="inputAircraftMod" id="inputAircraftMod" class="form-control" placeholder="Aircraft Model" readonly>
        // <input type="text" name="inputDrones" id="inputDrones" class="form-control" placeholder="List of Drones" readonly> -->

        <div class='wrapper2'>
          <select id="inputModel" name="res" method="GET" action="/">
            <option value="{{modelRes[0]}}" selected>{{modelRes[0]}}</option>
            {% for r in modelRes[1:] %}
              <option id="selectedModel" name="selectedModel" value="{{r.aircraft_mod}}">{{r.aircraft_mod}}</option>
            {% endfor %}
          </select>
          <button class='get_model_result'>Calculate</button>
          <div class='drone_list' ></div>
          <button class='get_drone_result'>Calculate</button>
          <div class='test'></div>
          <input type="text" name="test" id="test" class="form-control" placeholder="TEST" readonly>
        </div>

        <!-- <input type="text" name="PicTitle" id="PicTitle" class="form-control" placeholder="PIC Title" readonly>
        // <input type="text" name="FaaUasCertNum" id="faaUasCertNum" class="form-control" placeholder="FAA UAS Cert Num" readonly>
        // <input type="text" name="IssueOn" id="IssueOn" class="form-control" placeholder="Issued On" readonly>
        // <input type="text" name="ValidUntil" id="ValidUntil" class="form-control" placeholder="Valid Unitl" readonly>
        // <input type="text" name="AmaNum" id="AmaNum" class="form-control" placeholder="AMA Num" readonly> -->


        <h1>DRONE</h1>


        <div class='wrapper5'>
          <h1>LOCATION</h1>
          <div style="height:500px;" id="map"></div>
          <p id='currLat' hidden></p><p id='currLong' hidden></p>
          <h1>WEATHER</h1>
          <button class='get_weather'>Get Weather</button>
          <input type="text" name="weatherTemp" id="weatherTemp" class="form-control" placeholder="weatherTemp" readonly>
          <input type="text" name="weatherSumm" id="weatherSumm" class="form-control" placeholder="weatherSumm" readonly>
        </div>

        <div class='wrapper6'>
          <button id="submit_form" class='submit_form' type="button">Submit Form</button>
          <input type="text" name="submitForm" id="submitForm" placeholder="!!" readonly>
        </div>
      </div>

      <!-- mission - text field -->
      <!-- team (3 ppl)
        camera operator
        drone operator
        visual observer -->
  </body>

  <script type="text/javascript">
    var currLat = 42.318032;
    var currLong = -72.637384;
    document.getElementById("currLat").value = currLat;
    document.getElementById("currLong").value = currLong;
    var map = L.map('map').setView([42.318032, -72.637384], 16);
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox.streets',
        accessToken: 'your.mapbox.access.token'
    }).addTo(map);
    var myMarker = L.marker([42.318032, -72.637384], {title: "MyLocation", alt: "MyLocation", draggable: true})
    .addTo(map)
    .on('dragend', function() {
      var coord = String(myMarker.getLatLng()).split(',');
      var currLat = coord[0].split('(')[1];
      var currLong = coord[1].split(')')[0];
      myMarker.bindPopup("Current Location: " + currLat + ", " + currLong + ".");
      document.getElementById("currLat").value = currLat;
      document.getElementById("currLong").value = currLong;
    });

  </script>
</html>



<!-- TODO:
- when changing selection in drop down, not grabbing the correct ID... seems to get only the first in the list
- did pilot info & make/drones, need to do specific drone model info
- weather stuff w map
- convert results and append to csv
- append entry to db
  - make a db for entries

//pilot
selectedPilot
PicTitle
FaaUasCertNum
IssueOn
ValidUntil
AmaNum
//model
inputAircraftMod

//drone
selectedDrone

//location/weather
currLat
currLong
weatherTemp
weatherSumm



Error Code: 1427. For float(M,D), double(M,D) or decimal(M,D), M must be >= D (column 'lat').

ADD:
https://darksky.net/dev/docs
"time": 1509993277,
"summary": "Drizzle",
"icon": "rain",
"nearestStormDistance": 0,
"precipIntensity": 0.0089,
"precipIntensityError": 0.0046,
"precipProbability": 0.9,
"precipType": "rain",
"temperature": 66.1,
"apparentTemperature": 66.31,
"dewPoint": 60.77,
"humidity": 0.83,
"pressure": 1010.34,
"windSpeed": 5.59,
"windGust": 12.03,
"windBearing": 246,
"cloudCover": 0.7,
"uvIndex": 1,
"visibility": 9.84,
"ozone": 267.44
 -->
